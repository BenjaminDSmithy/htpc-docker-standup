##
## -------------------------
## | H T P C - D O C K E R |
## -------------------------
##
## Container based media tools configuration
##
## -- DO NOT EDIT THIS FILE --
##
## Configuration items for this file are taken from the .env file
##
## Have docker-compose.yml and .env in the same directory to launch the stack

version: '2'

######################
# SERVICES TO LAUNCH #
######################

services:

    # ----------------------------------------
    # PORTAINER
    # Docker Container Management
    # ----------------------------------------
    portainer:
        image: portainer/portainer:latest
        container_name: portainer
        restart: unless-stopped
        network_mode: 'bridge'
        ports:
            - '9000:9000'
        environment:
            - PUID=${PUID}
            - PGID=${PGID}
            #- VIRTUAL_HOST=portainer.${DOMAIN}
            #- LETSENCRYPT_HOST=portainer.${DOMAIN}
            #- LETSENCRYPT_EMAIL=${EMAIL}
        volumes:
            - './portainer:/data'
            - '/var/run/docker.sock:/var/run/docker.sock'
            - '/etc/localtime:/etc/localtime:ro'
        command: --admin-password "$$2y$$05$$/w17ylCmg3CeLQvDjr5v9.dnUB5pWLrW6U9GuKsbjjb8LKdIA7zT6"

    # ----------------------------------------
    # WATCHTOWER
    # Automatic Update Service for Docker VMs
    # ----------------------------------------
    watchtower:
        image: v2tec/watchtower
        container_name: watchtower
        restart: unless-stopped
        environment:
            - TZ=${TZ}
        network_mode: 'bridge'
        volumes:
            - '/var/run/docker.sock:/var/run/docker.sock'
        command: portainer --schedule @midnight --cleanup

    # ----------------------------------------
    # NETDATA
    # System Resource Monitoring Service
    # ----------------------------------------
    netdata:
        image: titpetric/netdata
        container_name: netdata
        restart: unless-stopped
        network_mode: 'bridge'
        ports:
            - '19999:19999'
        environment:
            - PUID=${PUID}
            - PGID=${PGID}
            ##- VIRTUAL_HOST=netdata.${DOMAIN}
            #- LETSENCRYPT_HOST=netdata.${DOMAIN}
            #- LETSENCRYPT_EMAIL=${EMAIL}
        cap_add:
            - SYS_PTRACE
        volumes:
            - '/proc:/host/proc:ro'
            - '/sys:/host/sys:ro'
            - '/etc/localtime:/etc/localtime:ro'
            - '/var/run/docker.sock:/var/run/docker.sock'