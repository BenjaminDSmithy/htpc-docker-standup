
#| ---------------------------
#| | M E D I A - D O C K E R |
#| ---------------------------
#|
#| Container based media tools configuration
#|
#|
#| -- DO NOT EDIT THIS FILE --
#|
#| Configuration items for this file are taken from the .env file
#|
#| Have media-docker-compose.yaml and .env in the same directory to launch the stack

version: '3'

######################
# SERVICES TO LAUNCH #
######################

services:

    #--------------------------------------------#
   ## PLEX                                       ##
   ##  Robust Media Server                       ##
    #--------------------------------------------#
    plex:
        container_name: plex-server
        image: hotio/plex:${PLEX_TAG}
        restart: always
        hostname: ${HOSTNAME}
        networks:
            - web
        ports:
            - '${IP_ADDRESS}:32400:32400/tcp'
            - '${IP_ADDRESS}:3005:3005/tcp'
            - '${IP_ADDRESS}:8324:8324/tcp'
            - '${IP_ADDRESS}:32469:32469/tcp'
            - '${IP_ADDRESS}:1900:1900/udp'
            - '${IP_ADDRESS}:32410:32410/udp'
            - '${IP_ADDRESS}:32412:32412/udp'
            - '${IP_ADDRESS}:32413:32413/udp'
            - '${IP_ADDRESS}:32414:32414/udp'
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - PLEX_PASS=${PLEX_PASS}
            - PLEX_CLAIM=${PLEX_TOKEN}

            # Only for the autoscan tag.
            - PLEXAUTOSCAN_ARGS=${PLEXAUTOSCAN_ARGS}
            - PLEX_LOGIN=${PLEX_LOGIN}
            - PLEX_PASSWORD=${PLEX_PASSWORD}

            - ADVERTISE_IP=http://${IP_ADDRESS}:32400/
            - ALLOWED_NETWORKS=${CIDR_ADDRESS}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/plex-server/config:/config'
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/plex-server/transcode:/transcode'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=32400'
            - 'traefik.frontend.rule=Host:plex.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'




    #--------------------------------------------#
   ## TAUTULLI                                   ##
   ##  Monitoring Service for PLEX Usage         ##
    #--------------------------------------------#
    plexpy:
        image: hotio/tautulli:${DEFAULT_TAG}
        container_name: tautulli
        restart: always
        networks:
            - web
        expose:
            - 8181
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/tautulli:/config'
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/plex-server/config/Plex Media Server/Logs:/logs:ro'
            - '/etc/localtime:/etc/localtime:ro'
        depends_on:
            - plex
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8181'
            - 'traefik.frontend.rule=Host:plexpy.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## ORGANIZR                                   ##
   ##  Web Frontend for HTPC Management          ##
    #--------------------------------------------#
    organizr:
        image: organizrtools/organizr-v2:${DEFAULT_TAG}
        container_name: organizr-${ORGANIZR_VERSION}
        restart: unless-stopped
        networks:
            - web
        ports:
            - '39280:39280/tcp'
            - '443/tcp'
            - '80/tcp'
        expose:
            - 39280
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/organizr-${ORGANIZR_VERSION}:/config'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=39280'
            - 'traefik.frontend.rule=Host:manage.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## QBITTORRENT+VPN                            ##
   ##  qBitTorrent Client + OpenVPN              ##
    #--------------------------------------------#
    qbittorrent-vpn:
        image: binhex/arch-qbittorrentvpn:${DEFAULT_TAG}
        container_name: qbittorrentvpn
        restart: unless-stopped
        networks:
            - web
        ports:
            - '${IP_ADDRESS}:6881:6881/tcp'
            - '${IP_ADDRESS}:6881:6881/udp'
            - '${IP_ADDRESS}:${WEBUI_PORT}:${WEBUI_PORT}/tcp' ## Access qBittorrent (web ui)
            - '${IP_ADDRESS}:8118:8118/tcp' ## Access Privoxy
        expose:
            - 8112
        cap_add:
            - NET_ADMIN
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
            - VPN_ENABLED=${VPN_ENABLED}
            - VPN_USER=${VPN_UNAME}
            - VPN_PASS=${VPN_PASS}
            - VPN_REMOTE=${VPN_REMOTE}
            - VPN_PORT=1198
            - VPN_PROTOCOL=udp
            - VPN_DEVICE_TYPE=tun
            - VPN_PROV=${VPN_PROVIDER}
            - VPN_OPTIONS=${VPN_OPTIONS}
            - ENABLE_PRIVOXY=${ENABLE_PRIVOXY}
            - STRICT_PORT_FORWARD=${STRICT_PORT_FORWARD}
            - LAN_NETWORK=${CIDR_ADDRESS}
            - NAME_SERVERS=${NAME_SERVERS}
            - DEBUG=false
            - WEBUI_PORT=${WEBUI_PORT}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/qb-vpn:/config'
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/qb-vpn/openvpn/${VPNPROVIDER}:/${VPNPROVIDER}'
            - '/${ROOT_FOLDER_PATH}/shared/downloads/torrents:/shared/downloads/torrents'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8112'
            - 'traefik.frontend.rule=Host:qb.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## SONARR                                     ##
   ##  TV Series Management                      ##
    #--------------------------------------------#
    sonarr:
        image: hotio/sonarr:${SONARR_TAG}
        container_name: sonarr-${SONARR_VERSION}
        restart: unless-stopped
        networks:
            - web
        expose:
            - 8989
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/sonarr-${SONARR_VERSION}:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8989'
            - 'traefik.frontend.rule=Host:sonarr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## SONARR (4K)                                ##
   ##  TV Series Management                      ##
    #--------------------------------------------#
    sonarr4k:
        image: hotio/sonarr:${SONARR_TAG}
        container_name: sonarr4k-${SONARR_VERSION}
        restart: unless-stopped
        networks:
            - web
        expose:
            - 9090
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/sonarr-${SONARR_VERSION}:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=9090'
            - 'traefik.frontend.rule=Host:sonarr4k.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## RADARR                                     ##
   ##  Movie Management                          ##
    #--------------------------------------------#
    radarr:
        image: hotio/radarr:${RADARR_TAG}
        container_name: radarr-${RADARR_VERSION}
        restart: unless-stopped
        networks:
            - web
        expose:
            - 7878
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/radarr-${RADARR_VERSION}:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=7878'
            - 'traefik.frontend.rule=Host:radarr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## RADARR (4K)                                ##
   ##  Movie Management                          ##
    #--------------------------------------------#
    radarr4k:
        image: hotio/radarr:${RADARR_TAG}
        container_name: radarr4k-${RADARR_VERSION}
        restart: unless-stopped
        networks:
            - web
        expose:
            - 7979
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/radarr4k-${RADARR_VERSION}:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=7979'
            - 'traefik.frontend.rule=Host:radarr4k.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## LIDARR                                     ##
   ##  Music Management                          ##
    #--------------------------------------------#
    lidarr:
        image: hotio/lidarr:${LIDARR_TAG}
        container_name: lidarr
        restart: unless-stopped
        networks:
            - web
        expose:
            - 8686
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/lidarr:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8686'
            - 'traefik.frontend.rule=Host:lidarr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## READARR                                    ##
   ##  eBook Management                          ##
    #--------------------------------------------#
    readarr:
        image: hotio/readarr:${READARR_TAG}
        container_name: readarr
        restart: unless-stopped
        networks:
            - web
        expose:
            - 8787
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/readarr:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8787'
            - 'traefik.frontend.rule=Host:lidarr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## CALIBRE                                    ##
   ##  eBook Management                          ##
    #--------------------------------------------#
    calibre-web:
        image: linuxserver/calibre-web:${CALIBRE_TAG}
        container_name: calibre-web
        restart: unless-stopped
        networks:
            - web
        expose:
            - 8083
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/calibre-web:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=8083'
            - 'traefik.frontend.rule=Host:calibre.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## BAZARR                                     ##
   ##  Subtitle Management                       ##
    #--------------------------------------------#
    bazarr:
        image: hotio/bazarr:${BAZARR_TAG}
        container_name: bazarr
        restart: unless-stopped
        networks:
            - web
        expose:
            - 6767
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/bazarr:/config'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/${ROOT_FOLDER_PATH}/@Recycle:/@Recycle'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=6767'
            - 'traefik.frontend.rule=Host:bazarr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## JACKETT                                    ##
   ##  RSS/TORZNAB Feed Creator                  ##
    #--------------------------------------------#
    jackett:
        image: hotio/jackett:${DEFAULT_TAG}
        container_name: jackett
        restart: unless-stopped
        networks:
            - web
        expose:
            - 9117
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/jackett:/config'
            - '/${ROOT_FOLDER_PATH}/shared/downloads/torrents:/shared/downloads/torrents'
            - '/${ROOT_FOLDER_PATH}/shared:/shared'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=9117'
            - 'traefik.frontend.rule=Host:jackett.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## OMBI                                       ##
   ##  Request Service for Plex Content          ##
    #--------------------------------------------#
    ombi:
        image: hotio/ombi:${OMBI_TAG}
        container_name: ombi-${OMBI_VERSION}
        restart: unless-stopped
        networks:
            - web
        expose:
            - 3579
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/ombi-${OMBI_VERSION}:/config'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=3579'
            - 'traefik.frontend.rule=Host:ombi.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




    #--------------------------------------------#
   ## REQUESTRR                                  ##
  ###  Discord bot used to simplify using        ###
   ##   services like Sonarr/Radarr/Ombi         ##
    #--------------------------------------------#
    requestrr:
        image: darkalfx/requestrr:${DEFAULT_TAG}
        container_name: requestrr
        restart: unless-stopped
        networks:
            - web
        expose:
            - 4545
        environment:
            - TZ=${TZ}
            - PUID=${PUID}
            - PGID=${PGID}
            - UMASK=${UMASK}
        volumes:
            - '/${ROOT_FOLDER_PATH}/containers/apps/media/requestrr:/root/config'
            - '/etc/localtime:/etc/localtime:ro'
        labels:
            - 'traefik.enable=true'
            - 'traefik.docker.network=${STACK_NAME}_web'
            - 'traefik.port=4545'
            - 'traefik.frontend.rule=Host:requestrr.${DOMAIN}'
            - 'traefik.frontend.entryPoints=https'
            - 'traefik.frontend.headers.forceSTSHeader=true'
            - 'traefik.frontend.headers.STSSeconds=315360000'
            - 'traefik.frontend.headers.STSIncludeSubdomains=true'
            - 'traefik.frontend.headers.STSPreload=true'




########################
# GLOBAL CONFIGURATION #
########################

networks:
    web:

